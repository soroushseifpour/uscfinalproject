@model IEnumerable<UscProject.Models.JobCategoryTB>
@{
    ViewBag.Title = "AddForms";
    Layout = "~/Areas/KarFarma/Views/Shared/_KarFarmaLayout.cshtml";
}
<link href="~/Areas/KarFarma/Content/assets/css/MyStyle.css" rel="stylesheet" />
<div class="row justify-content-between align-items-center mb-10">

    <!-- Page Heading Start -->
    <div class="col-12 col-lg-auto mb-20">
        <div class="page-heading">
            <h3>اگهی شغلی <span>/فرم جدید</span></h3>
        </div>
    </div><!-- Page Heading End -->
    <!-- Page Button Group Start -->
    <div class="col-12 col-lg-auto mb-20">
        <div class="buttons-group">
            <button class="button button-outline button-success btn-edit">ساخت فرم</button>
        </div>
    </div><!-- Page Button Group End -->

</div><!-- Page Headings End -->
<!-- Add or Edit Product Start -->
<div class="add-edit-product-wrap col-12">

    <div class="add-edit-product-form">

        <h4 class="title">درباره فرم</h4>

        <div class="row" id="addForm">
            <div class="col-lg-6 col-12 mb-30">
                <input id="City" class="form-control" type="text" value="">
                <div id="city" style="display:none"><p style="color:red">فیلد مورد نظر را پر کنید</p></div>
                شهر
            </div>
            <div class="col-lg-6 col-12 mb-30">
                <input id="Region" class="form-control" type="text" value="">
                <div id="region" style="display:none"><p style="color:red">فیلد مورد نظر را پر کنید</p></div>
                منطقه
            </div>

            <div class="col-lg-6 col-12 mb-30">
                <select id="catselected" class="form-control nice-select">

                    @foreach (var item in Model)
                    {
                        <option value="@item.JobID" data-id="@item.JobID" selected>@item.JobCategory</option>

                    }
                </select>
                تخصص
            </div>

            <div class="col-12 mb-30">
                <textarea id="FormText" class="form-control"></textarea>
                <div id="formtext" style="display:none"><p style="color:red">فیلد مورد نظر را پر کنید</p></div>
                توضیحات فرم
            </div>
            <div class="col-12 mb-30">
                <input id="JobDescRiption" class="form-control">
                <div id="jobdescription" style="display:none"><p style="color:red">فیلد مورد نظر را پر کنید</p></div>
                نوع شغل
            </div>
            <div class="col-12 mb-30"><textarea id="Requirements" class="form-control"></textarea> نرم افزاری های مورد نیاز</div>
            <div class="col-12 mb-30"><textarea id="Abilities" class="form-control"></textarea> توانایی ها</div>

            <div class="col-lg-6 col-12 mb-30">
                <select id="Gender" class="form-control nice-select">
                    <option value="مرد" selected>مرد</option>
                    <option value="زن">زن</option>
                    <option value="مرد-زن">مرد-زن</option>
                </select>
            </div>
            <div class="col-lg-6 col-12 mb-30">
                <input id="WorkingDays" class="form-control" type="text" value="">
                <div id="workingdays" style="display:none"><p style="color:red">فیلد مورد نظر را پر کنید</p></div>
                تعداد روز کاری
            </div>
            <div class="col-12 mb-30"><textarea id="Benefits" class="form-control"></textarea>مزایا</div>
        </div>
    </div>

</div>
<!--Basic End-->
@section PageScript
{
    <script src="~/Areas/Admin/Content/assets/js/plugins/moment/moment.min.js"></script>
    <script src="~/Areas/Admin/Content/assets/js/plugins/footable/footable.min.js"></script>
    <script src="~/Areas/Admin/Content/assets/js/plugins/footable/footable.active.js"></script>
    <script src="~/Areas/Admin/Content/assets/js/plugins/toastr/toastr.min.js"></script>
    <script src="~/Areas/Admin/Content/assets/js/plugins/toastr/toastr.active.js"></script>
    <script>
        var inputs = document.querySelectorAll('input')
        var textarea = document.querySelector('textarea')
        inputs.forEach(input => input.addEventListener('keyup', function (e) {
            let sibling = input.nextElementSibling
            sibling.style.display = "none"
        }))
        textarea.addEventListener('keyup', function (e) {
            let sibling = textarea.nextElementSibling
            sibling.style.display = "none"
        })
        $(function () {
            $(document).ready(function () {
                $(document).on("click", ".btn-edit", function (e) {
                    toastr.options = {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": false,
                        "positionClass": "toast-top-center",
                        "preventDuplicates": true,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    var form = document.querySelector('#addForm');
                    var city = document.getElementById('City').value;
                    if (city == "") {
                        document.getElementById('city').style.display = "block"
                        form.classList.add("apply-shake")
                    }
                    var region = document.getElementById('Region').value;
                    if (region == "") {
                        document.getElementById('region').style.display = "block"
                        form.classList.add("apply-shake")
                    }
                    var text = document.getElementById('FormText').value;
                    if (text == "") {
                        document.getElementById('formtext').style.display = "block"
                        form.classList.add("apply-shake")
                    }
                    var jobdescription = document.getElementById('JobDescRiption').value;
                    if (jobdescription == "") {
                        document.getElementById('jobdescription').style.display = "block"
                        form.classList.add("apply-shake")
                    }
                    var workingdays = document.getElementById('WorkingDays').value;
                    if (workingdays == "") {
                        document.getElementById('workingdays').style.display = "block"
                        form.classList.add("apply-shake")
                    }
                    var e = document.getElementById("catselected");
                    var jobcategory = e.options[e.selectedIndex].value;
                    var t = document.getElementById("Gender");
                    var gender = t.options[t.selectedIndex].value;


                    $.ajax({
                        type: "POST",
                        url: "/KarFarma/Forms/AddForms",
                        data: JSON.stringify({
                            Region: $("#Region").val(),
                            City: $("#City").val(),
                            Benefits: $("#Benefits").val(),
                            WorkingDays: $("#WorkingDays").val(),
                            Gender: gender,
                            FormText: $("#FormText").val(),
                            JobDescRiption: $("#JobDescRiption").val(),
                            Requirements: $("#Requirements").val(),
                            Abilities: $("#Abilities").val(),
                            JobID: jobcategory
                        }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (e) {
                            if (e.Status) {
                                toastr["success"]('تغییرات ذخیره شد')
                                setTimeout(function () { location.reload(); }, 2000);
                                
                            }
                            else {
                                toastr["error"]("لطفا بسته جدید بخرید!", "خطا")

                            }
                        },
                        error: function () {
                            toastr["warning"]('لطفا فیلدها را با دقت پرکنید');
                        }
                    });
                });

            });
        });

    </script>
}

